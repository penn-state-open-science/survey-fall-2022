# (PART) Data Analysis & Visualization {-}

# Data Gathering

## Set-up

We ensure that all package dependencies are installed.

```{r set-up}

if (!require(tidyverse)) {
  install.packages("tidyverse")
}
if (!require(googledrive)) {
  install.packages("googledrive")
}

suppressPackageStartupMessages(library("tidyverse")) # for pipe %>%
```

## Download data {-}

Download the data file from the spreadsheet generated by the Google Form into a comma-separated value (CSV) file in a local directory called `csv/`.

Authenticate to Google.
For the time being, you must run `googledrive:drive_auth()` at the console, separate from rendering the protocol via `bookdown::render_book()`.

```{r eval=FALSE}
googledrive::drive_auth()
```

```{r}
if (!dir.exists('csv')) {
  dir.create('csv')
}

csv_fn <- "csv/open-science-survey-2022-fall.csv"

googledrive::drive_download(file = 'C-ORR Survey 2022 Fall (Responses)', path = csv_fn, type = 'csv', overwrite = TRUE)
```

## Clean data {-}

Load the data file.

```{r}
if (file.exists(csv_fn)) {
  survey <- readr::read_csv(csv_fn, show_col_types = FALSE)
} else {
  message("File not found: ", csv_fn)
  survey <- NULL
}
```

Examine the variable names.

```{r}
if (is.null(survey)) {
  warning("Error loading data file")
} else {
  names(survey)
}
```
